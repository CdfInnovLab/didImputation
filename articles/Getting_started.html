<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started • didImputation</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started">
<meta property="og:description" content="didImputation">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">didImputation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Getting_started.html">Getting started</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CdfInnovLab/didImputation/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Getting_started_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CdfInnovLab/didImputation/blob/master/vignettes/Getting_started.Rmd"><code>vignettes/Getting_started.Rmd</code></a></small>
      <div class="hidden name"><code>Getting_started.Rmd</code></div>

    </div>

    
    
<p>This package implements the imputation method developed by <a href="https://uc5e4d5690cad8b63971f502beb3.dl.dropboxusercontent.com/cd/0/inline2/BTx5o7zNQteCIGa70QjOyslQ0p4DfhWhhY0TECO5mGPb_od1TbF97sfxQAm1P8GmDRtB3z8Sl4ayj_wk_HTDWXRNqElY6ARDcU8-98VK3YjZBDXh3CLVqx8cey4F-75YLZiBOZIy_rNvqUoR6I3g9Nozlm0oSww1UYMxefXQcewYB4CdPgIiFoZnNX4E79riQWYZF1VsfJbWyAVf8RMAGtLUcpXI7ATJXVsH58SUWzAACHyZgeIuZX9Ge7-0d0izDDe_JV-hJVN6zPvzkAjg787UX6JIwRRGeeovW8hEAtqzn21KCRvHwVwtVgXd3qBozo8XApe-PFKVeHOLkv4eCz-1kLkLyEVIws6l49nvolWa0-6VRyvyEOuyTxOgBy8TwbM/file">Borusyak, Jaravel, and Spiess (2021)</a> for staggered difference-in-differences. It allows for constant or dynamic treatment effects, among others. The following presentation highlights the main features available using a simple example. Note that this package is a wrapper around the following packages: <code>collapse</code>, <code>data.table</code> and <code>fixest</code>. It allows us a highly efficient estimation procedure, even with large and complex datasets.</p>
<div id="a-simple-example" class="section level1">
<h1 class="hasAnchor">
<a href="#a-simple-example" class="anchor"></a>A simple example</h1>
<div id="generating-simulated-data" class="section level2">
<h2 class="hasAnchor">
<a href="#generating-simulated-data" class="anchor"></a>Generating simulated data</h2>
<p>To show how to use the package, we will generate a simple dataset similar to the one used in the original paper. Let’s first load the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CdfInnovLab/didImputation">didImputation</a></span><span class="op">)</span></code></pre></div>
<p>The custom function <code>generateDidData</code> is directly available to generate simulated data. The setup is as follows:</p>
<ul>
<li>10000 units <span class="math inline">\(i\)</span> observed over 6 periods <span class="math inline">\(t\)</span>.</li>
<li>Units are randomly treated starting period 2 and some unit are never treated (<code>Inf</code> values). This information is summarized in <span class="math inline">\(g_{it}\)</span>, representing the treatment group. The next step consists in defining the relative time to treatment-or horizon-<span class="math inline">\(k_{it} = t-g\)</span>. For example, <span class="math inline">\(k_{it} = 0\)</span> means that unit <span class="math inline">\(i\)</span> is treated for the first time in period <span class="math inline">\(t\)</span>.</li>
<li>Treatment effects <span class="math inline">\(\tau_{it}\)</span> vary by horizon, with <span class="math inline">\(\tau_{it} = k_{it} + 1\)</span> for treated observations.</li>
<li>We assume a linear data generating process: <span class="math inline">\(Y_{it} = \alpha_i + \beta_t + \tau_{it} + \varepsilon_{it}\)</span>, where <span class="math inline">\(\alpha_i\)</span> are unit fixed-effects, <span class="math inline">\(\beta_t\)</span> are time fixed-effects and <span class="math inline">\(\varepsilon_{it} \sim \mathcal{N}(0,1)\)</span> are iid error terms.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateDidData.html">generateDidData</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">2000</span>,
                        t <span class="op">=</span> <span class="fl">6</span>,
                        hdfe <span class="op">=</span> <span class="cn">FALSE</span>,
                        control <span class="op">=</span> <span class="cn">FALSE</span>,
                        treatment <span class="op">=</span> <span class="op">~</span> <span class="va">d</span> <span class="op">*</span> <span class="op">(</span><span class="va">k</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Two implications are worth noting. They have been emphasized by the recent literature on staggered designs and are not specific to our setup.</p>
<ul>
<li>Nobody is treated in the first period: we need at least one period for which a unit is not treated in order to impute the given unit fixed-effect.</li>
<li>Some observations remain untreated in the last period. We cannot impute the time fixed-effect for a period where everybody is treated.</li>
</ul>
<p>Let’s plot the true treatment effects over time for each treatment group:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">agg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="st">"trueffect"</span><span class="op">]</span>,
                 by <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="st">"g"</span><span class="op">)</span><span class="op">]</span>,
                 <span class="va">mean</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">agg</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">x</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Period"</span>, y <span class="op">=</span> <span class="st">"True ATT"</span>, color <span class="op">=</span> <span class="st">"Treatment group"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<p><img src="Getting_started_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div id="estimation-procedure" class="section level2">
<h2 class="hasAnchor">
<a href="#estimation-procedure" class="anchor"></a>Estimation procedure</h2>
<p>The <code>didImputation</code> function estimates treatment effects. It allows for static and dynamic treatment effects (by horizon). Let’s review some main arguments and options of this function.</p>
<ul>
<li>
<code>y0</code> is the counterfactual formula, i.e the formula under no treatment. It follows the <code>fixest</code> syntax: fixed-effects are inserted after the <code>|</code>. See the online <a href="https://cran.r-project.org/web/packages/fixest/vignettes/fixest_walkthrough.html">documentation</a> for further details. We add a 0 as the first argument on the right hand side to exclude the intercept from the estimation.</li>
<li>
<code>data</code> is the dataset used for the estimation.</li>
<li>
<code>cohort</code> is the treatment group, in our case the treatment period.</li>
<li>
<code>unit</code> is the variable containing unit of observation identifiers. By default, it takes the first fixed-effect from the formula.</li>
<li>
<code>time</code> is the variable containing period of observation identifiers. By default, it takes the second fixed-effect from the formula.</li>
<li>
<code>coef</code> are the treatment coefficients to be estimated, given as a sequence. By default, it estimates the fully dynamic model with the maximum number of leads and lags. Note that for pre-trends, the omitted periods are the most distant ones. See below if you want to estimate the static treatment effect.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/didImputation.html">didImputation</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">i</span> <span class="op">+</span> <span class="va">t</span>,
                     data <span class="op">=</span> <span class="va">data</span>,
                     cohort <span class="op">=</span> <span class="st">"g"</span>,
                     nevertreated.value <span class="op">=</span> <span class="cn">Inf</span>,
                     unit <span class="op">=</span> <span class="st">"i"</span>,
                     time <span class="op">=</span> <span class="st">"t"</span>,
                     coef <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span><span class="op">:</span><span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<p>The <code>summary</code> method reports the results from the estimation:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span>
<span class="co">#&gt; Event Study: imputation method. Dep. Var.:  y </span>
<span class="co">#&gt; Counterfactual model:  y ~ 0 | i + t </span>
<span class="co">#&gt; Number of cohorts:  4 </span>
<span class="co">#&gt; Observations: 12000 </span>
<span class="co">#&gt; |-Treated:    5716 </span>
<span class="co">#&gt; |-Untreated:  6284 </span>
<span class="co">#&gt;       Estimate Std. Error t value Pr(&gt;|t|) </span>
<span class="co">#&gt; k::-3 0.225    0.138       1.625  0.104    </span>
<span class="co">#&gt; k::-2 0.083    0.158       0.527  0.599    </span>
<span class="co">#&gt; k::-1 0.135    0.185       0.731  0.465    </span>
<span class="co">#&gt; k::0  1.010    0.075      13.395  &lt;0.001***</span>
<span class="co">#&gt; k::1  2.001    0.084      23.760  &lt;0.001***</span>
<span class="co">#&gt; k::2  2.965    0.105      28.345  &lt;0.001***</span>
<span class="co">#&gt; k::3  4.035    0.134      30.007  &lt;0.001***</span>
<span class="co">#&gt; k::4  4.959    0.190      26.069  &lt;0.001***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. Code: 0 '***' 0.01 '**' 0.05 '*' 0.1 '' 1 </span>
<span class="co">#&gt; Wald stats for pre-trends:</span>
<span class="co">#&gt; Wald (joint nullity): stat = 1.2115, p = 0.303825, on 3 and 6,275 DoF, VCOV: Clustered (i).</span></code></pre></div>
<p>You can extract the coefficients table if you want to build your own plot or table.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">est</span><span class="op">$</span><span class="va">coeftable</span>
<span class="co">#&gt;         Estimate Std. Error    t value      Pr(&gt;|t|)</span>
<span class="co">#&gt; k::-3 0.22452247 0.13816495  1.6250320  1.043134e-01</span>
<span class="co">#&gt; k::-2 0.08333174 0.15825858  0.5265543  5.985615e-01</span>
<span class="co">#&gt; k::-1 0.13544823 0.18533088  0.7308454  4.649592e-01</span>
<span class="co">#&gt; k::0  1.00983018 0.07538679 13.3953194  6.439844e-41</span>
<span class="co">#&gt; k::1  2.00110261 0.08422251 23.7597120 8.720127e-125</span>
<span class="co">#&gt; k::2  2.96478863 0.10459647 28.3450165 9.641696e-177</span>
<span class="co">#&gt; k::3  4.03464313 0.13445590 30.0071852 7.908450e-198</span>
<span class="co">#&gt; k::4  4.95892963 0.19022448 26.0688294 8.230391e-150</span></code></pre></div>
<p>Finally, we can plot the coefficients from the fully dynamic model using the <code>didplot</code> function (note that you can choose the confidence interval level to report). The results are very close to the true effects:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/didplot.html">didplot</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span>, shape <span class="op">=</span> <span class="st">"True ATT"</span><span class="op">)</span>,
             size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"firebrick"</span> <span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_shape_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">9</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="Getting_started_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div id="overall-treatment-effect" class="section level2">
<h2 class="hasAnchor">
<a href="#overall-treatment-effect" class="anchor"></a>Overall treatment effect</h2>
<p>The <code>didImputation</code> function allows for overall treatment effects through the <code>OATT</code> argument. When set equal to <code>TRUE</code>, the estimation reports the coefficient for the total average treatment to the treated and the pre-trends coefficients from the <code>coef</code> argument:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">static</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/didImputation.html">didImputation</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">i</span> <span class="op">+</span> <span class="va">t</span>,
                     data <span class="op">=</span> <span class="va">data</span>,
                     cohort <span class="op">=</span> <span class="st">"g"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">static</span><span class="op">)</span>
<span class="co">#&gt; Event Study: imputation method. Dep. Var.:  y </span>
<span class="co">#&gt; Counterfactual model:  y ~ 0 | i + t </span>
<span class="co">#&gt; Number of cohorts:  4 </span>
<span class="co">#&gt; Observations: 12000 </span>
<span class="co">#&gt; |-Treated:    5716 </span>
<span class="co">#&gt; |-Untreated:  6284 </span>
<span class="co">#&gt;       Estimate Std. Error t value Pr(&gt;|t|) </span>
<span class="co">#&gt; k::-3 0.225    0.138       1.625  0.104    </span>
<span class="co">#&gt; k::-2 0.083    0.158       0.527  0.599    </span>
<span class="co">#&gt; k::-1 0.135    0.185       0.731  0.465    </span>
<span class="co">#&gt; k::0  1.010    0.075      13.395  &lt;0.001***</span>
<span class="co">#&gt; k::1  2.001    0.084      23.760  &lt;0.001***</span>
<span class="co">#&gt; k::2  2.965    0.105      28.345  &lt;0.001***</span>
<span class="co">#&gt; k::3  4.035    0.134      30.007  &lt;0.001***</span>
<span class="co">#&gt; k::4  4.959    0.190      26.069  &lt;0.001***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. Code: 0 '***' 0.01 '**' 0.05 '*' 0.1 '' 1 </span>
<span class="co">#&gt; Wald stats for pre-trends:</span>
<span class="co">#&gt; Wald (joint nullity): stat = 1.2115, p = 0.303825, on 3 and 6,275 DoF, VCOV: Clustered (i).</span></code></pre></div>
</div>
<div id="including-other-fixed-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#including-other-fixed-effects" class="anchor"></a>Including other fixed-effects</h2>
<p>Additional fixed-effects can be directly included in the formula after the <code>|</code>. Lets generate a dataset with a high-dimensional fixed-effects variable and estimate the model:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># generate data with hdfe</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateDidData.html">generateDidData</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">2000</span>,
                        t <span class="op">=</span> <span class="fl">6</span>,
                        hdfe <span class="op">=</span> <span class="cn">TRUE</span>,
                        control <span class="op">=</span> <span class="cn">FALSE</span>,
                        treatment <span class="op">=</span> <span class="op">~</span> <span class="va">d</span> <span class="op">*</span> <span class="op">(</span><span class="va">k</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="co"># fully dynamic estimation</span>
<span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/didImputation.html">didImputation</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">i</span> <span class="op">+</span> <span class="va">t</span> <span class="op">+</span> <span class="va">hdfefactor</span>,
                     data <span class="op">=</span> <span class="va">data</span>,
                     cohort <span class="op">=</span> <span class="st">"g"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span>
<span class="co">#&gt; Event Study: imputation method. Dep. Var.:  y </span>
<span class="co">#&gt; Counterfactual model:  y ~ 0 | i + t + hdfefactor </span>
<span class="co">#&gt; Number of cohorts:  4 </span>
<span class="co">#&gt; Observations: 12000 </span>
<span class="co">#&gt; |-Treated:    5554 </span>
<span class="co">#&gt; |-Untreated:  6446 </span>
<span class="co">#&gt;       Estimate Std. Error t value Pr(&gt;|t|) </span>
<span class="co">#&gt; k::-3  0.070   0.146       0.483  0.629    </span>
<span class="co">#&gt; k::-2 -0.144   0.161      -0.890  0.373    </span>
<span class="co">#&gt; k::-1 -0.143   0.183      -0.783  0.434    </span>
<span class="co">#&gt; k::0   1.026   0.075      13.707  &lt;0.001***</span>
<span class="co">#&gt; k::1   1.938   0.082      23.557  &lt;0.001***</span>
<span class="co">#&gt; k::2   2.878   0.102      28.134  &lt;0.001***</span>
<span class="co">#&gt; k::3   3.848   0.129      29.746  &lt;0.001***</span>
<span class="co">#&gt; k::4   5.068   0.178      28.497  &lt;0.001***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. Code: 0 '***' 0.01 '**' 0.05 '*' 0.1 '' 1 </span>
<span class="co">#&gt; Wald stats for pre-trends:</span>
<span class="co">#&gt; Wald (joint nullity): stat = 1.26591, p = 0.284247, on 3 and 6,398 DoF, VCOV: Clustered (i).</span></code></pre></div>
</div>
<div id="including-continuous-controls" class="section level2">
<h2 class="hasAnchor">
<a href="#including-continuous-controls" class="anchor"></a>Including continuous controls</h2>
<p>Additional continuous controls can be directly included in the formula before the <code>|</code>. Lets generate a dataset with such control and estimate the model:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># generate data with hdfe</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateDidData.html">generateDidData</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">2000</span>,
                        t <span class="op">=</span> <span class="fl">10</span>,
                        hdfe <span class="op">=</span> <span class="cn">FALSE</span>,
                        control <span class="op">=</span> <span class="cn">TRUE</span>,
                        treatment <span class="op">=</span> <span class="op">~</span> <span class="va">d</span> <span class="op">*</span> <span class="op">(</span><span class="va">k</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="co"># fully dynamic estimation</span>
<span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/didImputation.html">didImputation</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">|</span> <span class="va">i</span> <span class="op">+</span> <span class="va">t</span>,
                     data <span class="op">=</span> <span class="va">data</span>,
                     cohort <span class="op">=</span> <span class="st">"g"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span>
<span class="co">#&gt; Event Study: imputation method. Dep. Var.:  y </span>
<span class="co">#&gt; Counterfactual model:  y ~ x1 | i + t </span>
<span class="co">#&gt; Number of cohorts:  8 </span>
<span class="co">#&gt; Observations: 20000 </span>
<span class="co">#&gt; |-Treated:    9685 </span>
<span class="co">#&gt; |-Untreated:  10315 </span>
<span class="co">#&gt;       Estimate Std. Error t value Pr(&gt;|t|) </span>
<span class="co">#&gt; k::-5 0.117    0.097        1.209 0.227    </span>
<span class="co">#&gt; k::-4 0.086    0.106        0.811 0.418    </span>
<span class="co">#&gt; k::-3 0.044    0.116        0.382 0.702    </span>
<span class="co">#&gt; k::-2 0.122    0.127        0.959 0.338    </span>
<span class="co">#&gt; k::-1 0.131    0.141        0.930 0.352    </span>
<span class="co">#&gt; x1    1.982    0.011      187.271 &lt;0.001***</span>
<span class="co">#&gt; k::0  1.016    0.064       15.889 &lt;0.001***</span>
<span class="co">#&gt; k::1  1.972    0.068       29.057 &lt;0.001***</span>
<span class="co">#&gt; k::2  2.949    0.074       40.026 &lt;0.001***</span>
<span class="co">#&gt; k::3  4.009    0.083       48.047 &lt;0.001***</span>
<span class="co">#&gt; k::4  5.037    0.096       52.625 &lt;0.001***</span>
<span class="co">#&gt; k::5  5.967    0.111       53.858 &lt;0.001***</span>
<span class="co">#&gt; k::6  6.915    0.130       53.121 &lt;0.001***</span>
<span class="co">#&gt; k::7  8.138    0.164       49.706 &lt;0.001***</span>
<span class="co">#&gt; k::8  9.017    0.241       37.427 &lt;0.001***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. Code: 0 '***' 0.01 '**' 0.05 '*' 0.1 '' 1 </span>
<span class="co">#&gt; Wald stats for pre-trends:</span>
<span class="co">#&gt; Wald (joint nullity): stat = 5,849.3, p &lt; 2.2e-16, on 6 and 10,299 DoF, VCOV: Clustered (i).</span></code></pre></div>
</div>
<div id="heterogeneity" class="section level2">
<h2 class="hasAnchor">
<a href="#heterogeneity" class="anchor"></a>Heterogeneity</h2>
<p>We may want to run heterogeneity tests, this is particularly useful if we want to run an event-study with multiple contrasts (e.g. sex, age class, region) while keeping the whole sample (such that we maintain statistical power). We can do that simply with option <code>het</code>. The estimation will produce a result for each contrast.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Generate data with unit invariant heterogeneous effect</span>
<span class="va">data_het</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateDidData.html">generateDidData</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">5000</span>,
                        t <span class="op">=</span> <span class="fl">10</span>,
                        treatment <span class="op">=</span> <span class="op">~</span> <span class="va">d</span> <span class="op">*</span> <span class="op">(</span><span class="va">ig</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">k</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># Compute true ATT for later plot</span>
<span class="va">trueATT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span><span class="op">:</span><span class="fl">8</span>, <span class="fl">2</span><span class="op">)</span>,
                     ig <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">13</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">13</span><span class="op">)</span><span class="op">)</span>,
                     d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span><span class="op">:</span><span class="fl">8</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>

<span class="va">trueATT</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">trueATT</span>,<span class="op">{</span>
      <span class="va">d</span> <span class="op">*</span> <span class="op">(</span><span class="va">ig</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">k</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="co"># Estimate the heterogeneous effect</span>
<span class="va">est_het</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/didImputation.html">didImputation</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">i</span> <span class="op">+</span> <span class="va">t</span>,
              cohort <span class="op">=</span> <span class="st">"g"</span>,
              het <span class="op">=</span> <span class="st">"ig"</span>,
              data <span class="op">=</span> <span class="va">data_het</span>,
              coef <span class="op">=</span> <span class="op">-</span><span class="fl">4</span><span class="op">:</span><span class="cn">Inf</span><span class="op">)</span>

<span class="fu"><a href="../reference/didplot.html">didplot</a></span><span class="op">(</span><span class="va">est_het</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">trueATT</span>,
             <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">k</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ig</span><span class="op">)</span>, shape <span class="op">=</span> <span class="st">"True ATT"</span><span class="op">)</span>,
             size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_shape_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">9</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="Getting_started_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
</div>
<div id="additional-features" class="section level1">
<h1 class="hasAnchor">
<a href="#additional-features" class="anchor"></a>Additional features</h1>
<div id="sample-weights" class="section level2">
<h2 class="hasAnchor">
<a href="#sample-weights" class="anchor"></a>Sample weights</h2>
<p>Sample weights can be used by passing the variable in the <code>w</code> argument.</p>
</div>
<div id="standard-errors" class="section level2">
<h2 class="hasAnchor">
<a href="#standard-errors" class="anchor"></a>Standard errors</h2>
<p>The standard errors are computed using an alternating projection method. You can tweek its meta-parameter by changing <code>tol</code> and <code>maxit</code>. To speed up the estimation procedure, you can set <code>with.se = FALSE</code>. Standard errors will not be computed in this case but estimation will be significqntly quicker.</p>
</div>
<div id="effective-sample-size" class="section level2">
<h2 class="hasAnchor">
<a href="#effective-sample-size" class="anchor"></a>Effective sample size</h2>
<p>Borusyak, K., Jaravel, X., &amp; Spiess, J. give a condition on weights such that consistency of estimators holds. This condition states that the Herfindahl index of weights must converge to zero. Another interpretation is that the inverse of the index is a measure of ‘effective sample size’. Authors recommand an effective sample size of at least 30. If the effective sample size is lower, a warning will be thrown. You can tweek this parameter by changing <code>effective.sample</code> option in <code>didImputation</code>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Antoine Mayerowitz, Maxime Gravoueille.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
